1 # Business Logic
19 ## üß© –û–±—â–∞—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞
20
21 ```
22 Web API ‚Üí [PRODUCER] ‚Üí Kafka (orders.process) ‚Üí [CONSUMER] ‚Üí [PAYMENT SERVICE] (payment.process)
23                                                         ‚Üì
24                                                  DLQ (orders.process.dlq)
25 ```
26
27 ## üì¶ 1. –û—Ç–ø—Ä–∞–≤–∫–∞ —Å–æ–æ–±—â–µ–Ω–∏–π (PRODUCER)
28
29 ### –ö–∞–∫ —Ä–∞–±–æ—Ç–∞–µ—Ç:
30 - –°–æ–æ–±—â–µ–Ω–∏—è –æ—Ç–ø—Ä–∞–≤–ª—è—é—Ç—Å—è –≤ —Ç–æ–ø–∏–∫ `orders.process`
31 - –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –∫–ª—é—á `customer_id` –¥–ª—è —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è –ø–æ –ø–∞—Ä—Ç–∏—Ü–∏—è–º
32 - –ì–∞—Ä–∞–Ω—Ç–∏—è –¥–æ—Å—Ç–∞–≤–∫–∏: `acks='all'`
33 - –ü–æ–≤—Ç–æ—Ä—ã –ø—Ä–∏ –æ—à–∏–±–∫–∞—Ö: –¥–æ 3 —Ä–∞–∑
34
35 ### –ü—Ä–∏–º–µ—Ä —Å–æ–æ–±—â–µ–Ω–∏—è:
36 ```json
37 {
38   "order_id": "ORD-1001",
39   "customer_id": "CUST-001",
40   "amount": 99.99,
41   "timestamp": 1706000000,
42   "correlation_id": "uuid-string",
43   "source": "web-api"
44 }
45 ```
46
47 ### –£–Ω–∏–∫–∞–ª—å–Ω–æ—Å—Ç—å –ø–æ–ª–µ–π:
48 - `order_id` ‚Äî –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å —É–Ω–∏–∫–∞–ª—å–Ω—ã–º (–∏–¥–µ–Ω—Ç–∏—Ñ–∏—Ü–∏—Ä—É–µ—Ç –∑–∞–∫–∞–∑)  
49 - `customer_id` ‚Äî –º–æ–∂–µ—Ç –ø–æ–≤—Ç–æ—Ä—è—Ç—å—Å—è (–æ–¥–∏–Ω –∫–ª–∏–µ–Ω—Ç –¥–µ–ª–∞–µ—Ç –º–Ω–æ–≥–æ –∑–∞–∫–∞–∑–æ–≤)  
50 - `amount` ‚Äî –º–æ–∂–µ—Ç –ø–æ–≤—Ç–æ—Ä—è—Ç—å—Å—è (–æ–¥–∏–Ω–∞–∫–æ–≤—ã–µ —Å—É–º–º—ã –∑–∞–∫–∞–∑–æ–≤ –≤–æ–∑–º–æ–∂–Ω—ã)  
51 - `correlation_id` ‚Äî –≤—Å–µ–≥–¥–∞ —É–Ω–∏–∫–∞–ª–µ–Ω (–¥–ª—è —Ç—Ä–∞—Å—Å–∏—Ä–æ–≤–∫–∏)
52
53 ## üßÆ 2. –†–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –ø–æ –ø–∞—Ä—Ç–∏—Ü–∏—è–º
54
55 - **–ö–ª—é—á:** `customer_id`  
56 - **–ü—Ä–∞–≤–∏–ª–æ:** –æ–¥–∏–Ω–∞–∫–æ–≤—ã–µ `customer_id` ‚Üí –≤—Å–µ–≥–¥–∞ –≤ –æ–¥–Ω–æ–π –ø–∞—Ä—Ç–∏—Ü–∏–∏  
57 - **–¶–µ–ª—å:** –≥–∞—Ä–∞–Ω—Ç–∏—è –ø–æ—Ä—è–¥–∫–∞ –æ–±—Ä–∞–±–æ—Ç–∫–∏ –¥–ª—è –æ–¥–Ω–æ–≥–æ –∫–ª–∏–µ–Ω—Ç–∞  
58 - **–ü—Ä–∏–º–µ—Ä:**  
59   - `CUST-001` ‚Üí –≤—Å–µ –µ–≥–æ –∑–∞–∫–∞–∑—ã –≤ –æ–¥–Ω–æ–π –ø–∞—Ä—Ç–∏—Ü–∏–∏  
60   - `CUST-002` ‚Üí –≤ –¥—Ä—É–≥–æ–π –ø–∞—Ä—Ç–∏—Ü–∏–∏
61
62 ## üîÑ 3. –û–±—Ä–∞–±–æ—Ç–∫–∞ —Å–æ–æ–±—â–µ–Ω–∏–π (CONSUMER)
63
64 ### –í–∞–ª–∏–¥–∞—Ü–∏—è:
65 - –ü—Ä–æ–≤–µ—Ä–∫–∞ –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã—Ö –ø–æ–ª–µ–π: `order_id`, `customer_id`, `amount`  
66 - –ü—Ä–æ–≤–µ—Ä–∫–∞ `amount > 0` (–∏–Ω–∞—á–µ –æ—à–∏–±–∫–∞)
67
68 ### Event-Driven –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞:
69 - –ï—Å–ª–∏ `amount > 100` ‚Üí —Å–æ–æ–±—â–µ–Ω–∏–µ –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç—Å—è –≤ `payment.process`  
70 - –ù–æ–≤–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ:
71 ```json
72 {
73   "order_id": "ORD-1002",
74   "amount": 149.50,
75   "payment_status": "pending",
76   "processed_at": 1706000000
77 }
78 ```
79
80 ## üì¶ 4. –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫ –∏ DLQ
81
82 ### –ï—Å–ª–∏ —Å–æ–æ–±—â–µ–Ω–∏–µ –Ω–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ:
83 - –ù–µ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç—Å—è  
84 - –û—Ñ—Ñ—Å–µ—Ç –Ω–µ –∫–æ–º–º–∏—Ç–∏—Ç—Å—è (—Å–æ–æ–±—â–µ–Ω–∏–µ –±—É–¥–µ—Ç –æ–±—Ä–∞–±–æ—Ç–∞–Ω–æ —Å–Ω–æ–≤–∞)  
85 - –û—Ç–ø—Ä–∞–≤–ª—è–µ—Ç—Å—è –≤ `orders.process.dlq`  
86 - –û—Ä–∏–≥–∏–Ω–∞–ª —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è –¥–ª—è –∞–Ω–∞–ª–∏–∑–∞
87
88 ### –°—Ü–µ–Ω–∞—Ä–∏–∏ –æ—à–∏–±–æ–∫:
89 - –û—Ç—Å—É—Ç—Å—Ç–≤—É—é—Ç –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ –ø–æ–ª—è  
90 - `amount <= 0`  
91 - –ù–µ–≤–∞–ª–∏–¥–Ω—ã–π JSON
92
93 ## üîÑ 5. –î—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏–µ —Å–æ–æ–±—â–µ–Ω–∏–π
94
95 ### –¢–µ–∫—É—â–µ–µ –ø–æ–≤–µ–¥–µ–Ω–∏–µ:
96 - **–ù–µ—Ç –∑–∞—â–∏—Ç—ã –æ—Ç –¥—É–±–ª–µ–π**  
97 - –ï—Å–ª–∏ –ø—Ä–æ–¥—é—Å–µ—Ä –æ—Ç–ø—Ä–∞–≤–∏—Ç –æ–¥–Ω–æ –∏ —Ç–æ –∂–µ —Å–æ–æ–±—â–µ–Ω–∏–µ –¥–≤–∞–∂–¥—ã ‚Äî –æ–±–∞ –±—É–¥—É—Ç –æ–±—Ä–∞–±–æ—Ç–∞–Ω—ã  
98 - –≠—Ç–æ –º–æ–∂–µ—Ç –ø—Ä–∏–≤–µ—Å—Ç–∏ –∫ –¥—É–±–ª—è–º –≤ `payment.process`
99
100 ## üß™ 6. –¢–µ—Å—Ç-—Å—Ü–µ–Ω–∞—Ä–∏–∏ –¥–ª—è QA
101
102 | –¢–µ—Å—Ç-–∫–µ–π—Å          | –ö–∞–∫ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å                                      | –û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç                     |
103 |--------------------|--------------------------------------------------|-----------------------------------------|
104 | –ü–æ—Ä—è–¥–æ–∫ —Å–æ–æ–±—â–µ–Ω–∏–π   | –û—Ç–ø—Ä–∞–≤–∏—Ç—å 3 –∑–∞–∫–∞–∑–∞ –¥–ª—è `CUST-001` ‚Üí –ø—Ä–æ–≤–µ—Ä–∏—Ç—å –ø–∞—Ä—Ç–∏—Ü–∏—é | –í—Å–µ –≤ –æ–¥–Ω–æ–π –ø–∞—Ä—Ç–∏—Ü–∏–∏                   |
105 | –í–∞–ª–∏–¥–∞—Ü–∏—è          | –û—Ç–ø—Ä–∞–≤–∏—Ç—å `amount = -10` ‚Üí –ø—Ä–æ–≤–µ—Ä–∏—Ç—å DLQ         | –°–æ–æ–±—â–µ–Ω–∏–µ –≤ `orders.process.dlq`        |
106 | Event-driven       | –û—Ç–ø—Ä–∞–≤–∏—Ç—å `amount = 150` ‚Üí –ø—Ä–æ–≤–µ—Ä–∏—Ç—å `payment.process` | –°–æ–æ–±—â–µ–Ω–∏–µ –≤ `payment.process`          |
107 | –î—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏–µ       | –û—Ç–ø—Ä–∞–≤–∏—Ç—å –æ–¥–∏–Ω `order_id` –¥–≤–∞–∂–¥—ã ‚Üí –ø—Ä–æ–≤–µ—Ä–∏—Ç—å `payment.process` | –í–æ–∑–º–æ–∂–Ω–æ, 2 —Å–æ–æ–±—â–µ–Ω–∏—è (–µ—Å–ª–∏ –Ω–µ—Ç –∏–¥–µ–º–ø–æ—Ç–µ–Ω—Ç–Ω–æ—Å—Ç–∏) |
108 | –ü–æ–≤—Ç–æ—Ä–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ | –û—Å—Ç–∞–Ω–æ–≤–∏—Ç—å consumer ‚Üí –æ—Ç–ø—Ä–∞–≤–∏—Ç—å —Å–æ–æ–±—â–µ–Ω–∏–µ ‚Üí –∑–∞–ø—É—Å—Ç–∏—Ç—å ‚Üí –ø—Ä–æ–≤–µ—Ä–∏—Ç—å | –°–æ–æ–±—â–µ–Ω–∏–µ –æ–±—Ä–∞–±–æ—Ç–∞–Ω–æ –ø–æ–≤—Ç–æ—Ä–Ω–æ          |
109
110 ## üö® 7. –ü–æ—Ç–µ–Ω—Ü–∏–∞–ª—å–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã
111
112 | –ü—Ä–æ–±–ª–µ–º–∞               | –†–∏—Å–∫                                  | –†–µ—à–µ–Ω–∏–µ                     |
113 |------------------------|---------------------------------------|-----------------------------|
114 | –ù–µ—Ç –∑–∞—â–∏—Ç—ã –æ—Ç –¥—É–±–ª–µ–π   | –ü–æ–≤—Ç–æ—Ä–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ –º–æ–∂–µ—Ç —Å–æ–∑–¥–∞—Ç—å –¥—É–±–ª–∏ | –î–æ–±–∞–≤–∏—Ç—å `idempotency_key` |
115 | –û—à–∏–±–∫–∏ –≤–∞–ª–∏–¥–∞—Ü–∏–∏       | –°–æ–æ–±—â–µ–Ω–∏—è —Ç–µ—Ä—è—é—Ç—Å—è –±–µ–∑ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è    | –ù–∞—Å—Ç—Ä–æ–∏—Ç—å –∞–ª–µ—Ä—Ç—ã –Ω–∞ DLQ    |
116 | –ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω–æ–µ —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ | –û–¥–∏–Ω –∫–ª–∏–µ–Ω—Ç –≤ —Ä–∞–∑–Ω—ã—Ö –ø–∞—Ä—Ç–∏—Ü–∏—è—Ö      | –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Ö–µ—à-—Ñ—É–Ω–∫—Ü–∏—é      |
117
118 ## üí° 8. –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏
119
120 - –î–æ–±–∞–≤–∏—Ç—å –∏–¥–µ–º–ø–æ—Ç–µ–Ω—Ç–Ω–æ—Å—Ç—å –¥–ª—è –∑–∞—â–∏—Ç—ã –æ—Ç –¥—É–±–ª–µ–π  
121 - –ù–∞—Å—Ç—Ä–æ–∏—Ç—å –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ DLQ  
122 - –î–æ–±–∞–≤–∏—Ç—å –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ `correlation_id` –¥–ª—è —Ç—Ä–∞—Å—Å–∏—Ä–æ–≤–∫–∏  
123 - –í–Ω–µ–¥—Ä–∏—Ç—å Prometheus-–º–µ—Ç—Ä–∏–∫–∏ –¥–ª—è –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞
124
125 ---
126
127 –•–æ—Ç–∏—Ç–µ, —è –ø–æ–¥–≥–æ—Ç–æ–≤–ª—é **–≥–æ—Ç–æ–≤—ã–π ZIP-–∞—Ä—Ö–∏–≤** —Å–æ –≤—Å–µ–º –ø—Ä–æ–µ–∫—Ç–æ–º (–≤–∫–ª—é—á–∞—è —ç—Ç–æ—Ç —Ñ–∞–π–ª)?  
128 –ü—Ä–æ—Å—Ç–æ —Å–∫–∞–∂–∏—Ç–µ: **¬´–î–∞–π –∞—Ä—Ö–∏–≤¬ª** ‚Äî –∏ —è —Å–¥–µ–ª–∞—é –∑–∞ 2 –º–∏–Ω—É—Ç—ã.